# 物料领用审批模块开发计划

## 1. 数据库与模型变更

### 修改 `wms_outbound` 表结构

新增以下字段以支持审批流程和更详细的申请信息：

* `approval_status`: 审批状态 (PENDING: 待审批, APPROVED: 已通过, REJECTED: 已驳回)

* `approval_opinion`: 审批意见

* `approver_id`: 审批人ID

* `approval_time`: 审批时间

* `opening_date`: 开封日期

* `remarks`: 备注说明

### 更新 `Outbound` 模型

* 在 `internal/models/outbound.go` 中添加上述字段映射。

## 2. 业务逻辑重构 (Service层)

### 重构 `ApplyOutbound` (申请领用)

* **变更前**: 立即扣减库存，状态设为 USING。

* **变更后**:

  * 仅校验库存是否充足（不扣减）。

  * 创建领出记录，状态设为 `PENDING`。

  * 保存 `OpeningDate` 和 `Remarks`。

### 新增 `AuditOutbound` (审批领用)

* **功能**: 处理管理员的审批操作。

* **逻辑**:

  * **通过 (APPROVED)**:

    * 开启事务。

    * 再次校验库存。

    * **执行库存扣减**。

    * 更新状态为 `APPROVED`。

    * 记录审批人、时间、意见。

  * **驳回 (REJECTED)**:

    * 更新状态为 `REJECTED`。

    * 记录审批人、时间、意见。

    * 不扣减库存。

## 3. 控制器与接口开发 (Controller层)

* **更新** **`Apply`** **接口**: 支持接收 `opening_date` 和 `remarks` 参数。

* **新增** **`Audit`** **接口**: `POST /api/v1/outbound/audit`，用于管理员提交审批结果。

* **更新** **`List`** **接口**: 增加按 `approval_status` 筛选的功能，支持管理员查看待办审批。

## 4. 路由配置

* 在 `internal/routers/router.go` 中注册新的审批接口，并配置 `Admin` 权限中间件。

## 5. 消息通知 (简易版)

* 在审批通过/驳回后，通过日志模拟发送站内信/邮件通知（根据现有架构，暂不集成真实邮件服务，除非项目中已有）。

